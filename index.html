<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Micro:bit Interactive Kit</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #buttons { display:flex; flex-wrap:wrap; width:620px; margin-bottom:10px; }
    button { width: 120px; height: 40px; margin:2px; font-size:14px; }
    #messageInput { width: 250px; font-size:16px; }
    #send { font-size:16px; }
    #microbitText { width:100%; height:80px; font-size:16px; padding:4px; margin-bottom:20px; }
    canvas { border: 2px solid #333; background:#eee; display:block; margin-top:20px; }
  </style>
</head>
<body>
  <h2>Micro:bit Interactive Kit</h2>
  <button id="connect">Connect to Micro:bit</button>

  <h3>Send Commands via Buttons</h3>
  <div id="buttons"></div>

  <h3>Send Text to Micro:bit</h3>
  <input type="text" id="messageInput" placeholder="Type message here">
  <button id="send">Send</button>

  <h3>Text from Micro:bit:</h3>
  <textarea id="microbitText" readonly></textarea>

  <h3>Catch the Stars Game</h3>
  <canvas id="gameCanvas" width="400" height="300"></canvas>

  <script>
    // ------------------ Serial Setup ------------------
    let port, writer, reader;
    const microbitText = document.getElementById("microbitText");

    async function connect() {
      try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });
        writer = port.writable.getWriter();
        reader = port.readable.getReader();
        readSerial();
      } catch(err) {
        alert("Error connecting to Micro:bit: " + err);
      }
    }

    async function readSerial() {
      const decoder = new TextDecoder();
      let buffer = "";
      while(true) {
        const { value, done } = await reader.read();
        if(done) break;
        if(value) {
          buffer += decoder.decode(value);
          let lines = buffer.split("\n");
          buffer = lines.pop();
          lines.forEach(line => handleMicrobitCommand(line.trim()));
        }
      }
    }

    async function sendCommand(cmd) {
      if(!writer) return;
      await writer.write(new TextEncoder().encode(cmd + "\n"));
    }

    document.getElementById("connect").addEventListener("click", connect);

    // ------------------ 20 Editable Buttons ------------------
    const buttonLabels = [
      "LED1","LED2","LED3","LED4","LED5",
      "SMILE","SAD","HEART","STAR","CLEAR",
      "MUSIC1","MUSIC2","ARROWLEFT","ARROWRIGHT","FLASH",
      "BITMAP1","BITMAP2","YES","NO","RANDOM"
    ];
    const commands = [...buttonLabels];
    const buttonsDiv = document.getElementById("buttons");
    buttonLabels.forEach((label, index) => {
      const btn = document.createElement("button");
      btn.innerText = label;
      btn.onclick = () => sendCommand(commands[index]);
      btn.ondblclick = () => {
        const newLabel = prompt("Enter new button label:", btn.innerText);
        if (newLabel && newLabel.trim() !== "") {
          btn.innerText = newLabel.trim();
          commands[index] = newLabel.trim().toUpperCase();
        }
      };
      buttonsDiv.appendChild(btn);
    });

    // ------------------ Keyboard Input ------------------
    con
