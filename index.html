<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Micro:bit Serial Controller</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { margin: 5px; padding: 10px; }
    #messages { border: 1px solid #444; padding: 10px; height: 200px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>Micro:bit Serial Controller</h1>

  <button id="connect">üîå Connect Micro:bit</button>
  <br><br>

  <!-- 10 programmable buttons -->
  <div id="buttonContainer"></div>
  <br>

  <!-- Send free text -->
  <input id="textInput" type="text" placeholder="Type message to Micro:bit">
  <button onclick="sendText()">Send</button>
  <button onclick="clearLog()">Clear Log</button>

  <h3>Text from Micro:bit:</h3>
  <div id="messages"></div>

<script>
let port, writer;
const buttonLabels = ["LED1","LED2","LED3","LED4","LED5","SMILE","SAD","HEART","STAR","CLEAR"];

async function connect() {
  try {
    port = await navigator.serial.requestPort();
    await port.open({ baudRate: 115200 });
    writer = port.writable.getWriter();
    readLoop();
    log("‚úÖ Connected to micro:bit");
  } catch (e) {
    log("‚ùå " + e);
  }
}

async function readLoop() {
  const decoder = new TextDecoderStream();
  port.readable.pipeTo(decoder.writable);
  const reader = decoder.readable.getReader();
  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    if (value) log(value.trim());
  }
}

function log(text) {
  const messages = document.getElementById("messages");
  messages.innerHTML += text + "<br>";
  messages.scrollTop = messages.scrollHeight;
}

function clearLog() {
  document.getElementById("messages").innerHTML = "";
}

function sendCommand(cmd) {
  if (writer) writer.write(new TextEncoder().encode(cmd + "\n"));
}

function sendText() {
  const text = document.getElementById("textInput").value;
  if (text) sendCommand(text);
}

// make 10 editable buttons
const container = document.getElementById("buttonContainer");
buttonLabels.forEach(label => {
  const input = document.createElement("input");
  input.type = "text";
  input.value = label;
  input.style.marginRight = "5px";

  const btn = document.createElement("button");
  btn.textContent = label;
  btn.onclick = () => sendCommand(input.value);

  input.oninput = () => btn.textContent = input.value;

  container.appendChild(input);
  container.appendChild(btn);
  container.appendChild(document.createElement("br"));
});

document.getElementById("connect").onclick = connect;
</script>
</body>
</html>
